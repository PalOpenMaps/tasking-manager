(this["webpackJsonpTaskingManager-frontend"]=this["webpackJsonpTaskingManager-frontend"]||[]).push([[837],{1950:function(e,t,a){"use strict";var s=a(20);t.a=Object(s.b)({createProject:{id:"management.projects.create.title",defaultMessage:"Create new project"},cloneProject:{id:"management.projects.clone.message",defaultMessage:"The new project will be a clone of the project #{id} ({name})."},clone:{id:"management.projects.create.clone",defaultMessage:"Clone"},areaSize:{id:"management.projects.create.area_size",defaultMessage:"Area size: {area} km{sq}"},areaOverLimitError:{id:"management.projects.create.area_error",defaultMessage:"Project area is higher than {n} squared kilometers."},taskNumber:{id:"management.projects.create.tasks",defaultMessage:"Number of tasks: {n}"},step1:{id:"management.projects.create.steps.1",defaultMessage:"Step 1: define area"},step2:{id:"management.projects.create.steps.2",defaultMessage:"Step 2: set tasks sizes"},step3:{id:"management.projects.create.steps.3",defaultMessage:"Step 3: trim task grid"},step4:{id:"management.projects.create.steps.4",defaultMessage:"Step 4: review"},name:{id:"management.projects.create.review_tasks.name",defaultMessage:"Name"},organization:{id:"management.projects.create.review_tasks.organization",defaultMessage:"Organization"},creationFailed:{id:"management.projects.create.review_tasks.failure.message",defaultMessage:"It was not possible to save your project due to an error: {error}"},create:{id:"management.projects.create.review_tasks.button.create",defaultMessage:"Create"},reviewTaskNumberMessage:{id:"management.projects.create.review_tasks.number",defaultMessage:"Your project will be created with {n} tasks."},task:{id:"management.projects.create.review_tasks.task",defaultMessage:"task"},tasks:{id:"management.projects.create.review_tasks.tasks",defaultMessage:"tasks"},trimTasksDescriptionLine1:{id:"management.projects.create.trim_tasks.description.1",defaultMessage:"Trim the task grid to the area of interest (optional)."},trimTasksDescriptionLine2:{id:"management.projects.create.trim_tasks.description.2",defaultMessage:"You can keep the current tasks or trim the area for your project. This can take some time to execute."},trimToAOI:{id:"management.projects.create.trim_tasks.trim_to_aoi",defaultMessage:"Trim the tasks to define the exact Area of Interest for mapping."},tinyTasks:{id:"management.projects.create.trim_tasks.tiny_tasks",defaultMessage:"{number, plural, one {There is # task smaller than {area}m\xb2. Would you like to discard it?} other {There are # tasks smaller than {area}m\xb2. Would you like to discard them?}}"},discard:{id:"management.projects.create.trim_tasks.tiny_tasks.discard",defaultMessage:"Discard"},taskSizes:{id:"management.projects.create.task_sizes.description",defaultMessage:"General task size"},smaller:{id:"management.projects.create.task_sizes.smaller",defaultMessage:"Smaller"},larger:{id:"management.projects.create.task_sizes.larger",defaultMessage:"Larger"},invalidFile:{id:"management.projects.create.errors.invalid",defaultMessage:"It was not possible to read the geometries on the file. Verify it and upload again."},unsupportedGeom:{id:"management.projects.create.errors.unsupported_geom",defaultMessage:"Unsupported geometry type {geometry}"},noFeatureCollection:{id:"management.projects.create.errors.no_featurecollection",defaultMessage:"type field is not FeatureCollection"},closedLinestring:{id:"management.projects.create.errors.closed_linestring",defaultMessage:"Points do not form a closed linestring"},noGeometry:{id:"management.projects.create.errors.no_geometry",defaultMessage:"You need to define the project's area of interest."},noOrganization:{id:"management.projects.create.errors.no_organization",defaultMessage:"Organization is a required field."},fileSize:{id:"management.projects.create.errors.fileSize",defaultMessage:"We only accept files up to {fileSize} MB. Please reduce the size of your file and try again."},splitTaskDescription:{id:"management.projects.create.split_task.description",defaultMessage:"Make tasks smaller by clicking on specific tasks or drawing an area on the map."},reset:{id:"management.projects.create.reset.button",defaultMessage:"Reset"},showProjectsAOILayer:{id:"management.projects.create.show_aois",defaultMessage:"Show existing projects AoIs"},disabledAOILayer:{id:"management.projects.create.show_aois.disabled",defaultMessage:"Zoom in to be able to activate the visualization of other projects' areas of interest."},enableAOILayer:{id:"management.projects.create.show_aois.enable",defaultMessage:"Enable the visualization of the existing projects' areas of interest."},colorLegend:{id:"management.projects.create.show_aois.legend",defaultMessage:"Color legend:"},taskNumberMessage:{id:"management.projects.create.split.tasks.number",defaultMessage:"A new project will be created with {n} tasks."},taskAreaMessage:{id:"management.projects.create.split.tasks.area",defaultMessage:"The size of each task is approximately {area} km{sq}."},splitByDrawing:{id:"management.projects.create.split_task.draw.button",defaultMessage:"Draw area to split"},splitByClicking:{id:"management.projects.create.split_task.click.button",defaultMessage:"Click to split"},uploadError:{id:"management.projects.create.upload_file.error",defaultMessage:"Error when importing geometry. Verify if the file you uploaded is correct."},backToPrevious:{id:"management.projects.create.button.back",defaultMessage:"Back to previous"},next:{id:"management.projects.create.button.next",defaultMessage:"Next"},trim:{id:"management.projects.create.button.trim",defaultMessage:"Trim"},trimError:{id:"management.projects.create.trimError",defaultMessage:"An error occured while trimming the geometry."},SelfIntersectingAOIError:{id:"management.projects.create.SelfIntersectingAOIError",defaultMessage:"Invalid geometry - polygon is self intersecting."},draw:{id:"management.projects.create.button.draw",defaultMessage:"Draw"},selectFile:{id:"management.projects.create.button.select_file",defaultMessage:"Select file"},arbitraryTasks:{id:"management.projects.create.arbitrary_tasks",defaultMessage:"Set tasks using uploaded polygons"},defineAreaDescription:{id:"management.projects.create.draw.description",defaultMessage:"Draw the Area of Interest on the map or import a file."},importDescription:{id:"management.projects.create.upload.description",defaultMessage:"The supported file formats are: GeoJSON, KML, OSM or zipped Shapefile. You can drag and drop a file over the map to import it."}})},1964:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var s=a(1);const r=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const[a,r]=Object(s.useState)("idle"),[c,n]=Object(s.useState)(null),[i,o]=Object(s.useState)(null),l=Object(s.useCallback)((function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return r("pending"),n(null),o(null),e(t).then((e=>{n(e),r("success")})).catch((e=>{o(e),r("error")}))}),[e]);return Object(s.useEffect)((()=>{t&&l()}),[l,t]),{execute:l,status:a,value:c,error:i}}},2074:function(e,t,a){"use strict";a.d(t,"c",(function(){return d})),a.d(t,"b",(function(){return m})),a.d(t,"d",(function(){return j})),a.d(t,"a",(function(){return u}));var s=a(2075),r=a(1990),c=a(2039),n=a(9),i=a(2076),o=a.n(i),l=a(2093);const d=e=>{if(e.size>=n.v)throw Error("fileSize")},m=e=>{const t=e.name.split(".")[1].toLowerCase();if(!1===["json","geojson","kml","osm","xml","zip"].includes(t))throw Error("invalidFile")},j=(e,t)=>{if("FeatureCollection"!==e.type)throw Error("noFeatureCollection");return e.features=e.features.map((e=>((e,t)=>{if(!1===t.includes(e.geometry.type))throw Error("unsupportedGeom - ".concat(e.geometry.type));if("LineString"===e.geometry.type){const t=e.geometry.coordinates;if(JSON.stringify(t[0])!==JSON.stringify(t[t.length-1]))throw Error("closedLinestring");return Object(s.a)(e)}return e})(e,t))).filter((e=>Object(r.a)(e)>0)),e};const u=async e=>{const t=e.name.split(".")[1].toLowerCase();let a=await function(e,t){return new Promise(((a,s)=>{let r=new FileReader;r.onload=()=>{a(r.result)},r.onerror=s,"zip"===t?r.readAsArrayBuffer(e):r.readAsText(e)}))}(e,t);switch(t){case"json":case"geojson":return JSON.parse(a);case"kml":return Object(c.kml)((new DOMParser).parseFromString(a,"text/xml"));case"osm":let e=(new DOMParser).parseFromString(a,"text/xml");return l(e);case"xml":let t=(new DOMParser).parseFromString(a,"text/xml");return l(t);case"zip":return o()(a).then((e=>e))}}},2089:function(e,t){},2098:function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));a(1);var s=a(30),r=a(9),c=a(1950),n=a(0);const i=e=>{let t=!!c.a[e];return"fileSize"===e?Object(n.jsx)(s.a,{...c.a[e],values:{fileSize:r.v/1e6}}):e.includes("unsupportedGeom")?Object(n.jsx)(s.a,{...c.a[e.split("-")[0].trim()],values:{geometry:e.split("-")[1].trim()}}):t?Object(n.jsx)(s.a,{...c.a[e]}):null}},2353:function(e,t,a){"use strict";a.r(t);var s=a(1),r=a.n(s),c=a(10),n=a(6),i=a(46),o=a(50),l=a(30),d=a(20),m=a(92),j=a.n(m),u=a(1943),b=a(1990),g=a(1930),p=a(1922),h=a(2253),f=a(165),O=a.n(f),k=a(2072),x=a.n(k),w=(a(2071),a(1950)),y=a(62),v=a(145),M=a(75),N=a(29),S=a(1965),T=a(13),C=a(32),z=a(80);var G=a(0);function _(e){let{metadata:t,updateMetadata:a,uploadFile:r,drawHandler:c,deleteHandler:n,drawIsActive:i}=e;const{containsMultiplePolygons:o}=function(e){const[t,a]=Object(s.useState)(!1);return Object(s.useEffect)((()=>{e&&e.features&&e.features.length&&(e.features.length>1&&a(!0),1===e.features.length&&"MultiPolygon"===e.features[0].geometry.type&&a(!0)),(null===e||e.features&&0===e.features.length)&&a(!1)}),[a,e]),{containsMultiplePolygons:t}}(t.geom),{getRootProps:d,getInputProps:m,open:j}=Object(S.a)({onDrop:r,noClick:!0,noKeyboard:!0});return Object(G.jsxs)("div",{...d(),children:[Object(G.jsx)("h3",{className:"f3 fw6 mt0 mb3 ttu barlow-condensed blue-dark",children:Object(G.jsx)(l.a,{...w.a.step1})}),Object(G.jsxs)("div",{children:[Object(G.jsx)("p",{children:Object(G.jsx)(l.a,{...w.a.defineAreaDescription})}),Object(G.jsx)(C.c,{className:"bg-white ph3 pv2 mr2 ba ".concat(i?"red b--red":"blue-dark b--grey-light"),onClick:c,icon:Object(G.jsx)(T.Q,{className:"h1 w1 v-mid"}),children:Object(G.jsx)(l.a,{...w.a.draw})}),Object(G.jsx)("input",{...m()}),Object(G.jsx)(C.c,{className:"bg-white blue-dark ba b--grey-light ph3 pv2",onClick:j,icon:Object(G.jsx)(T.x,{className:"h1 w1 v-mid"}),children:Object(G.jsx)(l.a,{...w.a.selectFile})}),Object(G.jsx)("p",{className:"f6 blue-grey lh-title mt3",children:Object(G.jsx)(l.a,{...w.a.importDescription})})]}),Object(G.jsx)("div",{className:"pb2",children:o&&Object(G.jsx)(z.h,{label:Object(G.jsx)(l.a,{...w.a.arbitraryTasks}),labelPosition:"right",isChecked:t.arbitraryTasks,onChange:()=>a({...t,arbitraryTasks:!t.arbitraryTasks,tasksNumber:t.geom&&t.geom.features?t.geom.features.length:0})})}),t.geom&&Object(G.jsx)("div",{children:Object(G.jsx)(C.c,{className:"bg-white blue-dark ba b--grey-light ph3 pv2",onClick:n,icon:Object(G.jsx)(T.ob,{className:"w1 h1 v-top"}),children:Object(G.jsx)(l.a,{...w.a.reset})})})]})}var P=a(2294),I=a(2254),D=a(2256);const E=20037508.3392,A=(e,t)=>{const a=20037508.34*e/180;let s=Math.log(Math.tan((90+t)*Math.PI/360))/(Math.PI/180);return s=20037508.34*s/180,[a,s]},L=(e,t)=>[180*e/20037508.34,360*Math.atan(Math.exp(t*Math.PI/20037508.34))/Math.PI-90],F=(e,t,a,s)=>{const r=(t+1)*e-E,c=(a+1)*e-E,n=L(t*e-E,a*e-E),i=L(r,c),o={x:t,y:a,zoom:s,isSquare:!0},l=[n[0],n[1],i[0],i[1]],d=Object(D.a)(l);return Object(p.i)([d.geometry.coordinates],o)},q=(e,t)=>{let a=Object(g.a)(e);const s=A(a[0],a[1]),r=A(a[2],a[3]);a=[s[0],s[1],r[0],r[1]];return((e,t)=>{const a=Math.ceil(e[0]),s=Math.ceil(e[1]),r=Math.floor(e[2]),c=Math.floor(e[3]),n=E/Math.pow(2,t-1),i=parseInt(Math.floor((a+E)/n)),o=parseInt(Math.ceil((r+E)/n)),l=parseInt(Math.floor((s+E)/n)),d=parseInt(Math.ceil((c+E)/n));let m=[];for(let j=i;j<o;j++)for(let e=l;e<d;e++){let a=F(n,j,e,t);m.push(a)}return Object(p.e)(m)})(a,t)},B=(e,t)=>{let a=[];return e.features.forEach((e=>{let s=Object(p.k)(e.geometry.coordinates[0]);if(null===Object(I.a)(t,s))a.push(e);else{q(e,e.properties.zoom+1).features.forEach((e=>{a.push(e)}))}})),a};function J(e){let{metadata:t,mapObj:a,updateMetadata:r}=e;const[c,n]=Object(s.useState)(null),i=Object(s.useCallback)((e=>{const s=a.map.getSource("grid")._data;null===t.tempTaskGrid&&r({...t,tempTaskGrid:s});const c=Object(P.a)(e.features[0].geometry,.5),n=B(s,c);r({...t,taskGrid:Object(p.e)(n),tasksNumber:Object(p.e)(n).features.length})}),[r,t,a.map]);Object(s.useEffect)((()=>{"click"===c?(a.map.on("mouseenter","grid",(e=>{a.map.getCanvas().style.cursor="pointer"})),a.map.on("mouseleave","grid",(e=>{a.map.getCanvas().style.cursor=""})),a.map.on("click","grid",i)):(a.map.on("mouseenter","grid",(e=>{a.map.getCanvas().style.cursor=""})),a.map.off("click","grid",i))}),[a,i,c]);const o=Object(s.useCallback)((()=>{const e=t.zoomLevel+1,a=q(t.geom,e);r({...t,zoomLevel:e,tempTaskGrid:a,taskGrid:a,tasksNumber:a.features.length})}),[t,r]),d=Object(s.useCallback)((()=>{const e=t.zoomLevel-1,a=q(t.geom,e);e>0&&r({...t,zoomLevel:e,tempTaskGrid:a,taskGrid:a,tasksNumber:a.features.length})}),[t,r]);return Object(s.useLayoutEffect)((()=>(void 0!==a.map.getSource("grid")?a.map.getSource("grid").setData(t.taskGrid):a.map.addSource("grid",{type:"geojson",data:{type:"FeatureCollection",features:t.taskGrid}}),()=>{a.map.off("click","grid",i)})),[t,a,o,d,i]),Object(G.jsxs)(G.Fragment,{children:[Object(G.jsx)("h3",{className:"f3 ttu fw6 mt2 mb3 barlow-condensed blue-dark",children:Object(G.jsx)(l.a,{...w.a.step2})}),Object(G.jsxs)("div",{children:[Object(G.jsxs)("div",{children:[Object(G.jsx)("p",{children:Object(G.jsx)(l.a,{...w.a.taskSizes})}),Object(G.jsxs)("div",{role:"group",children:[Object(G.jsx)(C.c,{className:"bg-white blue-dark ba b--grey-light ph3 pv2 mr2",onClick:o,icon:Object(G.jsx)(T.V,{className:"h1 w1 v-mid"}),children:Object(G.jsx)(l.a,{...w.a.smaller})}),Object(G.jsx)(C.c,{className:"bg-white blue-dark ba b--grey-light ph3 pv2",onClick:d,icon:Object(G.jsx)(T.z,{className:"h1 w1 v-mid"}),children:Object(G.jsx)(l.a,{...w.a.larger})})]})]}),Object(G.jsxs)("div",{className:"pt3 pb1",children:[Object(G.jsx)("p",{children:Object(G.jsx)(l.a,{...w.a.splitTaskDescription})}),Object(G.jsxs)("div",{role:"group",children:[Object(G.jsx)(C.c,{className:"bg-white ph3 pv2 mr2 ba ".concat("click"===c?"red b--red":"blue-dark b--grey-light"),onClick:()=>n("click"===c?null:"click"),icon:Object(G.jsx)(T.k,{className:"v-mid",style:{width:"0.5rem"}}),children:Object(G.jsx)(l.a,{...w.a.splitByClicking})}),Object(G.jsx)(C.c,{className:"bg-white ph3 pv2 mr2 ba ".concat("draw"===c?"red b--red":"blue-dark b--grey-light"),onClick:()=>{n("draw"),a.map.on("mouseenter","grid",(e=>{a.map.getCanvas().style.cursor="crosshair"})),a.map.on("mouseleave","grid",(e=>{a.map.getCanvas().style.cursor=""})),a.map.once("draw.create",(e=>{const s=a.map.getSource("grid")._data;null===t.tempTaskGrid&&r({...t,tempTaskGrid:s});const c=e.features[0].id;a.draw.delete(c);const i=e.features[0].geometry,o=B(s,i);r({...t,taskGrid:Object(p.e)(o),tasksNumber:Object(p.e)(o).features.length}),n(null)})),a.draw.changeMode("draw_polygon")},icon:Object(G.jsx)(T.Q,{className:"h1 w1 v-mid"}),children:Object(G.jsx)(l.a,{...w.a.splitByDrawing})}),Object(G.jsx)(C.c,{className:"bg-white blue-dark ba b--grey-light ph3 pv2",onClick:()=>{r({...t,taskGrid:t.tempTaskGrid})},icon:Object(G.jsx)(T.ob,{className:"w1 h1 v-mid"}),children:Object(G.jsx)(l.a,{...w.a.reset})})]})]}),Object(G.jsx)("p",{className:"f6 blue-grey lh-title mt3 mb2",children:Object(G.jsx)(l.a,{...w.a.taskNumberMessage,values:{n:Object(G.jsx)("strong",{children:t.tasksNumber||0})}})}),Object(G.jsx)("p",{className:"f6 blue-grey lh-title mt1",children:t.taskGrid&&t.taskGrid.features&&Object(G.jsx)(l.a,{...w.a.taskAreaMessage,values:{area:Object(G.jsx)("strong",{children:(Object(b.a)(t.taskGrid.features[0])/1e6).toFixed(2)||0}),sq:Object(G.jsx)("sup",{children:"2"})}})})]})]})}var H=a(1964),Y=a(1914);const Q=e=>{const{clipStatus:t,metadata:a,updateMetadata:s,token:r}=e,c=JSON.stringify({areaOfInterest:a.geom,clipToAoi:t,grid:a.tempTaskGrid});return Object(N.d)("projects/actions/intersecting-tiles/",c,r).then((e=>{s({...a,tasksNumber:e.features.length,taskGrid:e})}))};function R(e){let{metadata:t,mapObj:a,updateMetadata:r}=e;const n=Object(c.d)((e=>e.auth.token)),[i,o]=Object(s.useState)(!1),[m,j]=Object(s.useState)(0),u=Object(H.a)(Q);return Object(s.useEffect)((()=>{a.map.getSource("grid").setData(Object(p.e)(t.taskGrid.features.filter((e=>Object(b.a)(e)>=2e3))));const e=t.taskGrid.features.filter((e=>Object(b.a)(e)<2e3));a.map.getSource("tiny-tasks").setData(Object(p.e)(e)),j(e.length)}),[t,a]),Object(G.jsxs)(G.Fragment,{children:[Object(G.jsx)("h3",{className:"f3 ttu fw6 mt2 mb3 barlow-condensed blue-dark",children:Object(G.jsx)(l.a,{...w.a.step3})}),Object(G.jsxs)("div",{children:[Object(G.jsx)("p",{children:Object(G.jsx)(l.a,{...w.a.trimTasksDescriptionLine1})}),Object(G.jsx)("p",{className:"pb2",children:Object(G.jsx)(l.a,{...w.a.trimTasksDescriptionLine2})}),0===m?Object(G.jsxs)(G.Fragment,{children:[Object(G.jsx)(z.h,{isChecked:i,labelPosition:"right",onChange:()=>o(!i),label:Object(G.jsx)(l.a,{...w.a.trimToAOI})}),Object(G.jsx)("div",{className:"pt3",children:Object(G.jsx)(C.c,{onClick:()=>u.execute({clipStatus:i,metadata:t,updateMetadata:r,token:n}),className:"bg-white blue-dark ba b--grey-light ph3 pv2",loading:"pending"===u.status,icon:Object(G.jsx)(T.q,{className:"h1 w1 v-mid"}),children:Object(G.jsx)(l.a,{...w.a.trim})})}),"error"===u.status&&Object(G.jsx)("div",{className:"mt3",children:Object(G.jsxs)(Y.a,{type:"error",children:["".concat(u.error.message,"Error")in w.a&&Object(G.jsx)(l.a,{...w.a["".concat(u.error.message,"Error")]}),!("".concat(u.error.message,"Error")in w.a)&&Object(G.jsx)(l.a,{...w.a.trimError})]})})]}):Object(G.jsxs)("div",{className:"pt0 fw6",children:[Object(G.jsxs)("div",{className:"cf w-100 pb2",children:[Object(G.jsx)("div",{className:"w-auto fl di h2",children:Object(G.jsx)("span",{className:"dib v-mid h1 w1 bg-pink mr2"})}),Object(G.jsx)("div",{className:"w-auto di",children:Object(G.jsx)(l.a,{...w.a.tinyTasks,values:{number:m,area:Object(G.jsx)(d.a,{value:2e3})}})})]}),Object(G.jsx)(C.c,{onClick:()=>((e,t)=>{const a=Object(p.e)(e.taskGrid.features.filter((e=>Object(b.a)(e)>=2e3)));t({...e,tasksNumber:a.features.length,taskGrid:a})})(t,r),className:"bg-white blue-dark ba b--grey-light ph3 pv2",icon:Object(G.jsx)(T.sb,{className:"h1 w1 v-mid"}),children:Object(G.jsx)(l.a,{...w.a.discard})})]})]})]})}var V=e=>{const t=Object(o.a)(),a=Object(H.a)((()=>new Promise(((t,a)=>e.handleCreate()))));return Object(G.jsxs)("div",{className:"pt2",children:[1===e.index?null:Object(G.jsx)(C.b,{onClick:()=>(e=>{switch(e.index){case 2:e.mapObj.map.getSource("grid").setData(Object(p.e)([])),e.updateMetadata({...e.metadata,tasksNumber:0});break;case 3:e.mapObj.map.getSource("tiny-tasks").setData(Object(p.e)([])),e.updateMetadata({...e.metadata,taskGrid:e.metadata.tempTaskGrid,tasksNumber:e.metadata.tempTaskGrid.features.length});break;case 4:e.setErr({error:!1,message:""})}let t=e.index-1;!0===e.metadata.arbitraryTasks&&(e.updateMetadata({...e.metadata,tasksNumber:0}),e.metadata.geom.features&&e.updateMetadata({...e.metadata,tasksNumber:e.metadata.geom.features.length}),t=1),e.setStep(t)})(e),className:"blue-dark bg-white mr3",children:Object(G.jsx)(l.a,{...w.a.backToPrevious})}),4===e.index?Object(G.jsx)(C.b,{onClick:()=>a.execute(),className:"white bg-red",loading:"pending"===a.status,children:null===e.cloneProjectData.name?Object(G.jsx)(l.a,{...w.a.create}):Object(G.jsx)(l.a,{...w.a.clone})}):Object(G.jsx)(C.b,{onClick:a=>{const s=(e=>{switch(e.index){case 1:if(e.metadata.area>=e.maxArea)return{error:!0,message:t.formatMessage(w.a.areaOverLimitError,{n:e.maxArea})};if(0===e.metadata.area)return{error:!0,message:t.formatMessage(w.a.noGeometry)};{const t=e.metadata.geom.features[0].id;e.mapObj.draw.delete(t),e.mapObj.map.getSource("aoi").setData(e.metadata.geom),e.updateMetadata({...e.metadata,tasksNumber:e.metadata.arbitraryTasks?e.metadata.geom.features.length:e.metadata.taskGrid.features.length}),e.mapObj.map.getSource("otherProjects").setData(Object(p.e)([]))}break;case 2:const a=e.mapObj.map.getSource("grid")._data;e.updateMetadata({...e.metadata,taskGrid:a,tempTaskGrid:a});break;case 3:break;default:return}let a=e.index+1;return!0===e.metadata.arbitraryTasks&&(a=4),e.setStep(a),{error:!1,message:""}})(e);e.setErr(s)},className:"white bg-red",children:Object(G.jsx)(l.a,{...w.a.next})})]})};function W(e){let{metadata:t,updateMetadata:a,token:r,projectId:c,cloneProjectData:n}=e;const[i,o]=Object(s.useState)(null);return Object(G.jsxs)(G.Fragment,{children:[Object(G.jsx)("h3",{className:"f3 ttu fw6 mt2 mb3 barlow-condensed blue-dark",children:Object(G.jsx)(l.a,{...w.a.step4})}),Object(G.jsx)("p",{className:"pt2",children:Object(G.jsx)(l.a,{...w.a.reviewTaskNumberMessage,values:{n:t.tasksNumber}})}),null===n.name?Object(G.jsxs)(G.Fragment,{children:[Object(G.jsx)("label",{htmlFor:"name",className:"f5 fw6 db mb2 pt3",children:Object(G.jsx)(l.a,{...w.a.name})}),Object(G.jsx)("input",{onChange:e=>{e.preventDefault(),a({...t,projectName:e.target.value})},id:"name",className:"input-reset ba b--black-20 pa2 mb2 db w-100",type:"text"})]}):null,null===n.organisation?Object(G.jsxs)(G.Fragment,{children:[Object(G.jsx)("label",{className:"f5 fw6 db mb2 pt3",children:Object(G.jsx)(l.a,{...w.a.organization})}),Object(G.jsx)(z.d,{orgId:t.organisation,onChange:e=>{o(null),a({...t,organisation:e.organisationId||""})},className:"z-5 w-75"})]}):null,i&&Object(G.jsx)(Y.a,{type:"error",children:Object(G.jsx)(l.a,{...w.a.creationFailed,values:{error:i}})})]})}var K=a(9),U=a(2074),Z=a(2098);const X=r.a.lazy((()=>Promise.all([a.e(831),a.e(812)]).then(a.bind(null,2369))));t.default=()=>{const e=Object(o.a)(),t=Object(c.d)((e=>e.auth.token)),a=Object(n.q)(),[r,m]=Object(s.useState)(!1),[f,k]=Object(s.useState)(!1),S=(e,t)=>{const a=["Polygon","MultiPolygon","LineString"];try{let s=Object(U.d)(e,a);se.map.fitBounds(Object(g.a)(s),{padding:200});const r=11,c=q(s,r);ae({...te,geom:s,area:(Object(b.a)(s)/1e6).toFixed(2),zoomLevel:r,taskGrid:c,tempTaskGrid:c}),!0===t&&se.map.getSource("aoi").setData(s)}catch(H){Q({error:!0,message:Object(Z.a)(H.message)||H.message})}},T=e=>{const t=e[0];if(!t)return null;try{Q({code:403,message:null}),Object(U.b)(t),Object(U.c)(t),Object(U.a)(t).then((e=>{S(e,!0)})).catch((e=>Q({error:!0,message:Object(Z.a)(e.message)||e.message})))}catch(a){C(),Q({error:!0,message:Object(Z.a)(a.message)||a.message})}},C=()=>{const e=se.draw.getAll();if(e.features.length>0){const t=e.features[0].id;se.draw.delete(t)}se.map.getSource("aoi")&&se.map.getSource("aoi").setData(Object(p.e)([])),ae({...te,area:0,geom:null,arbitraryTasks:!1,tasksNumber:0})},z=()=>{if(r)return m(!1),void se.draw.changeMode("simple_select");m(!0);const e=e=>{const t=se.draw.getAll();if(t.features.length>1){const e=t.features[0].id;se.draw.delete(e)}S(Object(p.e)(e.features),!1),m(!1)};se.map.on("draw.update",e),se.map.once("draw.create",e),se.draw.changeMode("draw_polygon")},[P,I]=Object(i.useQueryParam)("cloneFrom",i.NumberParam),[D,E]=Object(s.useState)(1),[A,L]=Object(s.useState)(null),[F,B]=Object(s.useState)(null),[H,Q]=Object(s.useState)({error:!1,message:null}),$=Object(s.useCallback)((async e=>{const a=await Object(N.b)("projects/".concat(e,"/"),t);L(a.projectInfo.name),B(a.organisation)}),[L,B,t]);Object(s.useLayoutEffect)((()=>{P&&!isNaN(Number(P))&&$(P)}),[P,$]);let ee={id:P,name:A,organisation:F};const[te,ae]=Object(s.useState)({geom:null,area:0,tasksNumber:0,taskGrid:null,projectName:"",zoomLevel:9,tempTaskGrid:null,arbitraryTasks:!1,organisation:""});Object(s.useLayoutEffect)((()=>{let e={error:!1,message:null};te.area>K.u&&(e={error:!0,message:Object(G.jsx)(l.a,{...w.a.areaOverLimitError,values:{n:K.u}})}),Q(e)}),[te]);const[se,re]=Object(s.useState)({map:null,draw:new x.a({displayControlsDefault:!1})}),ce=Object(s.useCallback)((s=>{if(!te.geom)throw Q({error:!0,message:e.formatMessage(w.a.noGeometry)}),new Error("Missing geom.");if(!te.organisation&&!s.organisation)throw Q({error:!0,message:e.formatMessage(w.a.noOrganization)}),new Error("Missing organization information.");M.b.dispatch(Object(v.a)(te));let r={areaOfInterest:Object(h.a)(te.geom,{precision:6}),projectName:te.projectName,organisation:te.organisation||s.organisation,tasks:Object(h.a)(te.taskGrid,{precision:6}),arbitraryTasks:te.arbitraryTasks};null!==s.name&&(r.projectName="",r.cloneFromProjectId=s.id),Object(N.d)("projects/",JSON.stringify(r),t).then((e=>{O.a.success(Object(G.jsx)(l.a,{...y.a.entityCreationSuccess,values:{entity:"project"}})),a("/manage/projects/".concat(e.projectId))})).catch((e=>{Q({error:!0,message:Object(G.jsx)(l.a,{...w.a.creationFailed,values:{error:e}})})}))}),[te,t,e,a]);Object(s.useEffect)((()=>{if(!t)return a("/login")}),[a,t]);return Object(G.jsxs)("div",{className:"cf vh-minus-122-ns h-100 pr0-l",children:[Object(G.jsx)("div",{className:"fl pt3 cf w-100",children:Object(G.jsx)("h2",{className:"f2 fw6 mt2 mb3 ttu barlow-condensed blue-dark",children:Object(G.jsx)(l.a,{...w.a.createProject})})}),Object(G.jsxs)("div",{className:"w-100 h-100-l h-50 pt3 pt0-l fr relative",children:[Object(G.jsx)(s.Suspense,{fallback:Object(G.jsx)(j.a,{showLoadingAnimation:!0,rows:30,delay:300}),children:Object(G.jsx)(X,{metadata:te,updateMetadata:ae,mapObj:se,setMapObj:re,step:D,uploadFile:T,showProjectsAOILayer:f})}),Object(u.supported)()&&Object(G.jsxs)(G.Fragment,{children:[Object(G.jsxs)("div",{className:"cf absolute bg-white o-90 top-1 left-1 pa3 mw6",children:[P&&Object(G.jsx)("p",{className:"fw6 pv2 blue-grey",children:Object(G.jsx)(l.a,{...w.a.cloneProject,values:{id:P,name:A}})}),Object(G.jsx)("div",{className:"pb2",children:(()=>{switch(D){case 1:return Object(G.jsx)(_,{metadata:te,updateMetadata:ae,uploadFile:T,drawHandler:z,deleteHandler:C,drawIsActive:r,showProjectsAOILayer:f,setShowProjectsAOILayer:k});case 2:return Object(G.jsx)(J,{mapObj:se,metadata:te,updateMetadata:ae});case 3:return Object(G.jsx)(R,{mapObj:se,metadata:te,updateMetadata:ae});case 4:return Object(G.jsx)(W,{metadata:te,updateMetadata:ae,token:t,cloneProjectData:ee});default:return}})()}),!0===H.error&&Object(G.jsx)(Y.a,{type:"error",children:H.message}),Object(G.jsx)(V,{index:D,setStep:E,metadata:te,mapObj:se,updateMetadata:ae,maxArea:K.u,setErr:Q,cloneProjectData:ee,handleCreate:()=>ce(ee)})]}),Object(G.jsxs)("div",{className:"cf absolute",style:{bottom:"3.5rem",left:"0.6rem"},children:[Object(G.jsx)("p",{className:"fl mr2 pa1 f7-ns white ".concat(te.area>K.u||0===te.area?"bg-red":"bg-green"),children:Object(G.jsx)(l.a,{...w.a.areaSize,values:{area:Object(G.jsx)(d.a,{value:te.area,unit:"kilometer"}),sq:Object(G.jsx)("sup",{children:"2"})}})}),Object(G.jsx)("p",{className:"fl bg-blue-light white mr2 pa1 f7-ns",children:Object(G.jsx)(l.a,{...w.a.taskNumber,values:{n:Object(G.jsx)(d.a,{value:te.tasksNumber})}})})]})]})]})]})}}}]);
//# sourceMappingURL=837.2401ef17.chunk.js.map