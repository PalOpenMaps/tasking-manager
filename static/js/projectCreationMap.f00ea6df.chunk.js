(this["webpackJsonpTaskingManager-frontend"]=this["webpackJsonpTaskingManager-frontend"]||[]).push([[812],{2073:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var o=a(1),c=a(9),s=a(0);const r=e=>{let{map:t}=e,a=c.c;c.r||(a=c.c.filter((e=>"object"===typeof e.value)));const[r,l]=Object(o.useState)(a[0].label);return Object(s.jsx)("div",{className:"bg-white blue-dark flex mt2 ml2 f7 fr br1 shadow-1",children:a.map(((e,a)=>Object(s.jsx)("div",{onClick:()=>(e=>{let a=e.value;"string"===typeof e.value&&(a="mapbox://styles/mapbox/"+e.value),t.setStyle(a),l(e.label)})(e),className:"ttc pv2 ph3 pointer link + ".concat(r===e.label?"bg-grey-light fw6":""),children:e.label},a)))})}},2369:function(e,t,a){"use strict";a.r(t);var o=a(1),c=a.n(o),s=a(10),r=a(1943),l=a.n(r),i=(a(1972),a(1922)),n=a(1954),d=a.n(n),j=a(2261),b=a.n(j),p=(a(2292),a(1965)),u=a(2059),m=a(9),g=a(29),O=a(123),f=a(2073),h=a(80),v=a(30),y=a(81),S=a(1950),x=a(1915),A=a(32),L=a(0);const w=e=>{let{isActive:t,setActive:a,disabled:o,isAoiLoading:c}=e;return Object(L.jsx)(L.Fragment,{children:Object(L.jsxs)("div",{className:"bg-white fl dib pv1 ph2 blue-dark mt2 mh2 f7 br1 shadow-1",children:[Object(L.jsx)(h.b,{isActive:t,disabled:o,changeState:()=>a(!t),className:"dib mr2 v-mid"}),Object(L.jsx)("span",{className:"di v-mid","data-tip":!0,children:Object(L.jsx)(v.a,{...S.a.showProjectsAOILayer})}),Object(L.jsx)("span",{className:"ml1",children:c&&Object(L.jsx)(A.a,{})}),Object(L.jsx)(y.a,{place:"bottom",children:o?Object(L.jsx)(v.a,{...S.a.disabledAOILayer}):Object(L.jsxs)("div",{children:[Object(L.jsx)("div",{className:"db",children:Object(L.jsx)(v.a,{...S.a.enableAOILayer})}),Object(L.jsx)("div",{className:"db pt2 pb1",children:Object(L.jsx)(v.a,{...S.a.colorLegend})}),Object(L.jsxs)("div",{className:"db",children:[Object(L.jsx)(D,{color:m.S.VALIDATED}),Object(L.jsx)(v.a,{...x.a.status_PUBLISHED})]}),Object(L.jsxs)("div",{className:"db",children:[Object(L.jsx)(D,{color:m.S.MAPPED}),Object(L.jsx)(v.a,{...x.a.status_DRAFT})]}),Object(L.jsxs)("div",{className:"db",children:[Object(L.jsx)(D,{color:m.S.BADIMAGERY}),Object(L.jsx)(v.a,{...x.a.status_ARCHIVED})]})]})})]})})},D=e=>{let{color:t}=e;return Object(L.jsx)("span",{style:{backgroundColor:t},className:"h1 w1 dib mr2"})};var k=a(1928);l.a.accessToken=m.r;try{l.a.setRTLTextPlugin(m.q)}catch{console.log("RTLTextPlugin is loaded")}t.default=e=>{let{mapObj:t,setMapObj:a,metadata:r,updateMetadata:n,step:j,uploadFile:h}=e;const v=c.a.createRef(),y=Object(s.d)((e=>e.preferences.locale)),S=Object(s.d)((e=>e.auth.token)),[x,A]=Object(o.useState)(!0),[D,P]=Object(o.useState)(!1),[N,E]=Object(o.useState)([]),[C,I]=Object(o.useState)(!1),[T]=Object(O.a)((()=>_()),1500),{getRootProps:R,getInputProps:M}=Object(p.a)({onDrop:1===j?h:()=>{},noClick:!0,noKeyboard:!0});Object(o.useEffect)((()=>{Object(g.b)("projects/").then((e=>E(e.mapResults)))}),[]);const _=()=>{if(D&&x&&1===j){I(!0);let e=t.map.getBounds(),a="".concat(e._sw.lng,",").concat(e._sw.lat,",").concat(e._ne.lng,",").concat(e._ne.lat);Object(g.b)("projects/queries/bbox/?bbox=".concat(a,"&srid=4326"),S).then((e=>{t.map.getSource("otherProjects").setData(e),I(!1)}))}},B=Object(o.useCallback)((()=>{t&&t.map&&t.map.getSource("otherProjects")&&t.map.getSource("otherProjects").setData(Object(i.e)([]))}),[t]);Object(o.useEffect)((()=>{x&&1===j?T():B()}),[x,T,B,j]),Object(o.useLayoutEffect)((()=>{if(!l.a.supported())return;const e=new l.a.Map({container:v.current,style:m.s,center:[0,0],zoom:1.3,attributionControl:!1}).addControl(new l.a.AttributionControl({compact:!1})).addControl(new d.a({defaultLanguage:y.substr(0,2)||"en"})).addControl(new l.a.ScaleControl({unit:"metric"}));return m.r&&e.addControl(new b.a({accessToken:m.r,mapboxgl:l.a,marker:!1,collapsed:!0,language:y.substr(0,2)||"en"}),"top-right"),a({...t,map:e}),()=>{t.map&&t.map.remove()}}),[]);const F=e=>{if(void 0===e.getSource("aoi")&&(e.addSource("aoi",{type:"geojson",data:Object(i.e)([])}),e.addLayer({id:"aoi",type:"fill",source:"aoi",paint:{"fill-color":m.d.orange,"fill-outline-color":"#929db3","fill-opacity":.3}})),void 0===e.getSource("grid")&&(e.addSource("grid",{type:"geojson",data:Object(i.e)([])}),e.addLayer({id:"grid",type:"fill",source:"grid",paint:{"fill-color":"#68707f","fill-outline-color":"#00f","fill-opacity":.3}})),void 0===e.getSource("tiny-tasks")&&(e.addSource("tiny-tasks",{type:"geojson",data:Object(i.e)([])}),e.addLayer({id:"tiny-tasks",type:"fill",source:"tiny-tasks",paint:{"fill-color":"#f0f","fill-outline-color":"#f0f","fill-opacity":.3}})),void 0===e.getSource("otherProjects")){const t=["match",["get","projectStatus"],"DRAFT",m.S.MAPPED,"PUBLISHED",m.S.VALIDATED,"ARCHIVED",m.S.BADIMAGERY,"rgba(0,0,0,0)"];e.addSource("otherProjects",{type:"geojson",data:Object(i.e)([])}),e.addLayer({id:"otherProjectsLine",type:"line",source:"otherProjects",paint:{"line-color":t,"line-width":2,"line-opacity":1}}),e.addLayer({id:"otherProjectsFill",type:"fill",source:"otherProjects",paint:{"fill-color":t,"fill-opacity":["match",["get","projectStatus"],"PUBLISHED",.1,.3]}})}},H=()=>{};return Object(o.useLayoutEffect)((()=>{const{map:e}=t,a=N&&N.features&&N.features.length>0,o=null!==e&&e.isStyleLoaded()&&void 0===e.getSource("projects")&&a,c=null!==e&&!e.isStyleLoaded()&&void 0===e.getSource("projects")&&a;o?Object(u.b)(e,N,H,!0):c&&e.on("load",(()=>Object(u.b)(e,N,H,!0))),null!==e&&void 0!==e.getSource("projects")&&a&&e.getSource("projects").setData(N)}),[t,N]),Object(o.useLayoutEffect)((()=>{null!==t.map&&l.a.supported()&&t.map.on("moveend",(e=>{T()}))})),Object(o.useLayoutEffect)((()=>{null!==t.map&&l.a.supported()&&(t.map.on("load",(()=>{t.map.addControl(new l.a.NavigationControl),t.map.addControl(t.draw),F(t.map)})),t.map.on("draw.delete",(e=>{n({...r,geom:null,area:0})})),t.map.on("zoomend",(e=>{t.map.getZoom()<9?P(!1):P(!0)})),t.map.on("style.load",(e=>{if(!m.r)return;F(t.map);0===t.draw.getAll().features.length&&void 0!==t.map.getSource("aoi")&&t.map.getSource("aoi").setData(r.geom),r.taskGrid&&1!==j&&void 0!==t.map.getSource("grid")?t.map.getSource("grid").setData(r.taskGrid):t.map.getSource("grid")&&t.map.getSource("grid").setData(Object(i.e)([]))})))}),[t,r,n,j]),l.a.supported()?Object(L.jsxs)("div",{className:"w-100 h-100-l relative",...R(),children:[Object(L.jsxs)("div",{className:"absolute top-0 right-0 z-5 mr2",children:[1===j&&Object(L.jsx)(w,{isActive:x,setActive:A,disabled:!D,isAoiLoading:C}),Object(L.jsx)(f.a,{map:t.map}),Object(L.jsx)("input",{className:"dn",...M()})]}),Object(L.jsx)("div",{id:"project-creation-map",className:"vh-50 h-100-l w-100",ref:v})]}):Object(L.jsx)(k.a,{className:"vh-50 h-100-l w-100"})}}}]);
//# sourceMappingURL=projectCreationMap.f00ea6df.chunk.js.map