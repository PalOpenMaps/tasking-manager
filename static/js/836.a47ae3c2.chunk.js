(this["webpackJsonpTaskingManager-frontend"]=this["webpackJsonpTaskingManager-frontend"]||[]).push([[836],{1976:function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));var c=s(9);function a(e,t){let s=[{label:"RapiD",value:"RAPID",url:c.P},{label:"iD Editor",value:"ID",url:c.n},{label:"JOSM",value:"JOSM",url:"http://127.0.0.1:8111"},{label:"Potlatch 2",value:"POTLATCH_2",url:c.N},{label:"Field Papers",value:"FIELD_PAPERS",url:"http://fieldpapers.org/compose"}];return e&&(s=s.filter((t=>e.includes(t.value)))),t&&e.includes("CUSTOM")&&s.push({label:t.name,value:"CUSTOM",url:t.url}),s}},2034:function(e,t,s){"use strict";s.d(t,"a",(function(){return a})),s.d(t,"b",(function(){return l}));var c=s(1);const a=[{label:"Bing",value:"Bing"},{label:"Mapbox Satellite",value:"Mapbox"},{label:"ESRI World Imagery",value:"EsriWorldImagery"},{label:"ESRI World Imagery (Clarity) Beta",value:"EsriWorldImageryClarity"},{label:"Maxar Premium",value:"Maxar-Premium"},{label:"Maxar Standard",value:"Maxar-Standard"},{label:"Custom",value:"custom"}],l=e=>Object(c.useMemo)((()=>{if(e){const t=a.filter((t=>t.value===e));return t.length?t[0]:a[a.length-1]}return null}),[e])},2050:function(e,t,s){"use strict";s.d(t,"b",(function(){return r})),s.d(t,"a",(function(){return o}));s(1);var c=s(50),a=s(55),l=s(13),n=s(0);const r=[{Icon:l.eb,title:"roads",value:"ROADS"},{Icon:l.G,title:"buildings",value:"BUILDINGS"},{Icon:l.tb,title:"waterways",value:"WATERWAYS"},{Icon:l.lb,title:"landUse",value:"LAND_USE"},{Icon:l.b,title:"other",value:"OTHER"}];function o(e){let{types:t=[],colorClass:s}=e;const l=Object(c.a)();return Object(n.jsx)(n.Fragment,{children:r.map(((e,c)=>Object(n.jsx)("span",{title:l.formatMessage(a.a[e.title]),children:Object(n.jsx)(e.Icon,{className:"ml1 mr3 ".concat(t&&t.includes(e.value)?s:"grey-light"),height:"23"})},c)))})}},2111:function(e,t,s){"use strict";s.d(t,"a",(function(){return u})),s.d(t,"b",(function(){return k}));var c=s(1),a=s(6),l=s(23),n=s(29),r=s(10),o=s(30),i=s(1917),j=s(32),d=s(2054),b=s(0);function u(e){let{projectId:t,lockedTasksLength:s,action:c}=e;const n=Object(a.n)();return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("h3",{className:"barlow-condensed f3 fw6 mv0",children:Object(b.jsx)(o.a,{...i.a.anotherLockedTask})}),Object(b.jsx)("div",{className:"mv4 lh-title",children:Object(b.jsx)(o.a,{...i.a[s>1?"anotherProjectLockTextPlural":"anotherProjectLockTextSingular"],values:{project:Object(b.jsx)("span",{className:"fw6",children:t}),n:Object(b.jsx)("span",{className:"fw6",children:s}),action:Object(b.jsx)("span",{className:"ttl",children:Object(b.jsx)(o.a,{...i.a[c]})})}})}),Object(b.jsx)(l.a,{to:"/projects/".concat(t,"/").concat(c,"/"),state:{directedFrom:n.pathname},children:Object(b.jsx)(j.b,{className:"bg-red white",children:Object(b.jsx)(o.a,{...i.a.goToProject,values:{project:t}})})})]})}function p(e){let{lockedTasks:t,action:s}=e;const c=Object(a.q)();return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("h3",{className:"barlow-condensed f3 fw6 mv0",children:Object(b.jsx)(o.a,{...i.a.anotherLockedTask})}),Object(b.jsx)("div",{className:"mv4 lh-title",children:Object(b.jsx)(o.a,{...i.a[t.tasks.length>1?"currentProjectLockTextPlural":"currentProjectLockTextSingular"],values:{taskId:Object(b.jsx)("span",{className:"fw6",children:t.tasks})}})}),Object(b.jsx)(j.b,{className:"bg-red white",onClick:()=>c("/projects/".concat(t.project,"/").concat(s,"/")),children:Object(b.jsx)(o.a,{...i.a[t.tasks.length>1?"workOnTasksPlural":"workOnTasksSingular"],values:{mapOrValidate:Object(b.jsx)(o.a,{...i.a[s]})}})})]})}const O=e=>{let{id:t,close:s,lockTasks:a}=e;const l=Object(r.d)((e=>e.auth.token)),[d,u]=Object(c.useState)(null);Object(c.useEffect)((()=>{(async e=>{const t=await Object(n.b)("licenses/".concat(e,"/"));u(t)})(t)}),[t]);return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("h3",{className:"barlow-condensed f3 fw6 mv0",children:Object(b.jsx)(o.a,{...i.a.lockErrorLicense})}),null===d?null:Object(b.jsxs)("div",{className:"mt3 lh-title",children:[Object(b.jsx)(o.a,{...i.a.lockErrorLicenseDescription}),Object(b.jsxs)("div",{className:"h5 ph2 overflow-scroll",children:[Object(b.jsx)("p",{className:"fw6 f5 ttu",children:d.name}),Object(b.jsx)("p",{className:"f6",children:d.description}),Object(b.jsx)("p",{className:"f6",children:d.plainText})]}),Object(b.jsxs)("div",{className:"w-100 pt3",children:[Object(b.jsx)(j.b,{onClick:()=>s(),className:"blue-dark bg-white mr2",children:Object(b.jsx)(o.a,{...i.a.cancel})}),Object(b.jsx)(j.b,{onClick:()=>{Object(n.d)("licenses/".concat(t,"/actions/accept-for-me/"),null,l).then((()=>a()))},className:"white bg-red",children:Object(b.jsx)(o.a,{...i.a.acceptLicense})})]})]})]})};function h(e){let{error:t,close:s,tasks:c,selectedTasks:a,setSelectedTasks:l,lockTasks:n}=e;const r="CannotValidateMappedTask"===t&&a.length>1;return Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("h3",{className:"barlow-condensed f3 fw6 mv0",children:i.a["".concat(t,"Error")]?Object(b.jsx)(o.a,{...i.a["".concat(t,"Error")]}):Object(b.jsx)(o.a,{...i.a.lockError})}),Object(b.jsx)("div",{className:"mv4 lh-title",children:i.a["".concat(t,"ErrorDescription")]?Object(b.jsx)(o.a,{...i.a["".concat(t,"ErrorDescription")]}):Object(b.jsx)(o.a,{...i.a.lockErrorDescription})}),Object(b.jsx)(m,{close:s,shouldShowDeselectButton:r,tasks:c,selectedTasks:a,setSelectedTasks:l,lockTasks:n})]})}function m(e){let{close:t,shouldShowDeselectButton:s,lockTasks:a,tasks:l,selectedTasks:n,setSelectedTasks:d}=e;const u=Object(r.d)((e=>e.auth.userDetails)),[p,O]=Object(c.useState)(!1);return Object(c.useEffect)((()=>{p&&(a(),O(!1))}),[p,a]),Object(b.jsxs)("div",{className:"w-100 pt3 flex justify-end",children:[Object(b.jsx)(j.b,{onClick:t,className:"mr2 ".concat(s?"bg-transparent black":"bg-red white"),children:Object(b.jsx)(o.a,{...i.a.closeModal})}),s&&Object(b.jsx)(j.b,{onClick:()=>{const e=l.features.filter((e=>e.properties.mappedBy===u.id)).map((e=>e.properties.taskId)),t=n.filter((t=>!e.includes(t)));d(t),O(!0)},className:"bg-red white mr2",children:Object(b.jsx)(o.a,{...i.a.deselectAndValidate})})]})}function k(e){let{project:t,error:s,close:c,lockTasks:a,tasks:l,selectedTasks:n,setSelectedTasks:r}=e;const o=Object(d.c)(),i="LOCKED_FOR_VALIDATION"===o.status?"validate":"map",j="UserLicenseError"===s&&!o.project;return Object(b.jsxs)("div",{className:"blue-dark bg-white pv2 pv4-ns ph2 ph4-ns",children:[j&&Object(b.jsx)(O,{id:t.licenseId,close:c,lockTasks:a}),"JOSM"===s&&Object(b.jsx)(h,{error:s,close:c}),!o.project&&!j&&"JOSM"!==s&&Object(b.jsx)(h,{error:s,close:c,lockTasks:a,tasks:l,selectedTasks:n,setSelectedTasks:r}),o.project&&o.project!==t.projectId&&"JOSM"!==s&&Object(b.jsx)(u,{projectId:o.project,action:i,lockedTasksLength:o.tasks.length}),o.project===t.projectId&&"JOSM"!==s&&Object(b.jsx)(p,{action:i,lockedTasks:o})]})}},2128:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));s(1);var c=s(50),a=s(30),l=s(1917),n=s(13),r=s(2034),o=s(0);function i(e){let{value:t=""}=e;const s=Object(c.a)(),i=Object(r.b)(t),j=function(e){if(e){if(e.startsWith("tms"))return"customTMSLayer";if(e.startsWith("wms"))return"customWMSLayer";if(e.startsWith("wmts"))return"customWMTSLayer";if(e.startsWith("http")||e.startsWith("https"))return"customLayer"}}(t);return Object(o.jsxs)("p",{className:"f125 fw7 pt1 pr3 ma0 truncate blue-dark",children:[j&&Object(o.jsx)("span",{title:t,children:Object(o.jsx)(a.a,{...l.a[j]})}),null!==i&&"custom"!==i.value&&Object(o.jsx)("span",{children:i.label}),!j&&null!==i&&"custom"===i.value&&Object(o.jsx)("span",{children:t}),!i&&Object(o.jsx)(a.a,{...l.a.noImageryDefined}),j&&Object(o.jsx)("span",{className:"pointer pl2 blue-light hover-blue-dark",title:s.formatMessage(l.a.copyImageryURL),children:Object(o.jsx)(n.l,{width:"16px",height:"16px",onClick:()=>navigator.clipboard.writeText(t)})})]})}},2340:function(e,t,s){"use strict";s.r(t);var c=s(1),a=s(10),l=s(6),n=s(82),r=s(30),o=s(1917),i=s(1976),j=s(2045),d=s(2054),b=s(29),u=s(121),p=s(32),O=s(2128),h=s(2050),m=s(2111),k=s(0);t.default=e=>{let{defaultUserEditor:t,project:s,tasks:x,taskAction:f,selectedTasks:v,setSelectedTasks:g}=e;const T=Object(l.q)(),w=Object(a.d)((e=>e.auth.token)),S=Object(a.d)((e=>e.preferences.locale)),[I,N]=Object(c.useState)(t),[E,M]=Object(c.useState)([]),[y,D]=Object(c.useState)(!1),[A,C]=Object(c.useState)(null),P=Object(a.c)(),L=Object(d.b)(),R=(e,t,c)=>{const a=Object(j.e)(I,s,x,v,[window.innerWidth,window.innerHeight],c,S);J(v,s.projectId,e),D(!1),T("/projects/".concat(s.projectId,"/").concat(t,"/").concat(a))},W=(e,t)=>{["JOSM","ID","RAPID"].includes(I)||e.close(),L(),C(t),D(!1)},J=(e,t,s)=>{P({type:"SET_LOCKED_TASKS",tasks:e}),P({type:"SET_PROJECT",project:t}),P({type:"SET_TASKS_STATUS",status:s})},_=async()=>{if(["selectAnotherProject","mappingIsComplete","projectIsComplete"].includes(f)||"ARCHIVED"===s.status)return void T("/explore/");if("JOSM"===I&&!window.safari)try{await fetch(Object(j.b)("version",{jsonp:"checkJOSM"}))}catch(t){return void C("JOSM")}let e;if(["JOSM","ID","RAPID"].includes(I)||(e=window.open("","TM-".concat(s.projectId,"-").concat(v))),["validateSelectedTask","validateAnotherTask","validateATask"].includes(f)){const t=v.filter((e=>x.features.filter((t=>t.properties.taskId===e&&"MAPPED"===t.properties.taskStatus)).length));t.length?(D(!0),Object(b.d)("projects/".concat(s.projectId,"/tasks/actions/lock-for-validation/"),JSON.stringify({taskIds:t}),w).then((t=>{R("LOCKED_FOR_VALIDATION","validate",e)})).catch((t=>W(e,t.message)))):C("noMappedTasksSelected")}if(["mapSelectedTask","mapAnotherTask","mapATask"].includes(f)&&(D(!0),Object(b.b)("projects/".concat(s.projectId,"/tasks/actions/lock-for-mapping/").concat(v[0],"/"),w,"POST").then((t=>{R("LOCKED_FOR_MAPPING","map",e)})).catch((t=>W(e,t.message)))),["resumeMapping","resumeValidation"].includes(f)){const t=Object(j.e)(I,s,x,v,[window.innerWidth,window.innerHeight],e,S),c="resumeMapping"===f?"map":"validate";T("/projects/".concat(s.projectId,"/").concat(c,"/").concat(t))}};Object(c.useEffect)((()=>{if(f&&s.mappingEditors&&(f.startsWith("validate")||"resumeValidation"===f)){const e=Object(i.a)(s.validationEditors,s.customEditor);M(e),s.validationEditors.includes(I)||F(e)}else{const e=Object(i.a)(s.mappingEditors,s.customEditor);M(e),s.mappingEditors.includes(I)||F(e)}}),[I,f,s.mappingEditors,s.validationEditors,s.customEditor,t]);const F=e=>N(e[0].value),U="db ttu f7 blue-grey mb2 fw5";return Object(k.jsxs)("div",{className:"cf bg-white pb2 ph4-l ph2",children:[null!==A&&Object(k.jsx)(n.a,{modal:!0,open:!0,closeOnEscape:!0,closeOnDocumentClick:!0,onClose:()=>C(null),children:e=>Object(k.jsx)(m.b,{project:s,error:A,close:e,lockTasks:_,tasks:x,selectedTasks:v,setSelectedTasks:g})}),Object(k.jsxs)("div",{className:"w-25-ns w-40 fl",children:[Object(k.jsx)("h3",{className:U,children:Object(k.jsx)(r.a,{...o.a.typesOfMapping})}),Object(k.jsx)("div",{className:"db fl pt1",children:Object(k.jsx)(h.a,{types:s.mappingTypes})})]}),Object(k.jsxs)("div",{className:"w-25-ns w-60 fl",children:[Object(k.jsx)("h3",{className:U,children:Object(k.jsx)(r.a,{...o.a.imagery})}),Object(k.jsx)(O.a,{value:s.imagery})]}),Object(k.jsxs)("div",{className:"w-20-ns w-40 fl",children:[Object(k.jsx)("h3",{className:U,children:Object(k.jsx)(r.a,{...o.a.editor})}),Object(k.jsx)(u.a,{options:E,value:I,display:Object(k.jsx)(r.a,{...o.a.selectEditor}),className:"bg-white bn pl0",toTop:!0,onChange:F})]}),Object(k.jsx)("div",{className:"w-30-ns w-60 fl tr",children:Object(k.jsx)("div",{className:"mt3",children:Object(k.jsx)(p.b,{className:"white bg-red fw5",onClick:()=>_(),loading:y,children:["selectAnotherProject","mappingIsComplete","projectIsComplete"].includes(f)||"ARCHIVED"===s.status?Object(k.jsx)(r.a,{...o.a.selectAnotherProject}):Object(k.jsx)(r.a,{...o.a[f],values:{number:v?v.length:0}})})})})]})}}}]);
//# sourceMappingURL=836.a47ae3c2.chunk.js.map